<?php

namespace MethodRequest\Call;

/**
 * @package DeliveryConfirm
 */
class DeliveryConfirm
{

  /**
   * @param -
   * @return string\bool
   */
  public function delivery_confirm() 
  {
    $url = "xxxxxx/wmsSync";

    $data = [
      200924399013703,200924701542480,200924838091971,200924382521259,200924508040247,20092427833287,200924853553623,200924876755,200924526979992,200924650772324,200924171711258,200924296910376,200924908405589,20092439085521,200924575215600,200924165524849,200924297477457,200924986962986,200924118554389,200924637575515,200924769378387,200924292609745,200924418416485,200924934763196,20092465189387,200924594040605,200924720094470,200924263432545,200924386656678,200924893804752,20092433792886,200924562609212,200924202723579,200924326012251,200924838246935,200924964970342,200924242425868,200924388523649,200924921390381,20092454890645,200924184498437,200924758960421,200924903088344,200924458352117,200924585963833,200924133268446,200924265551872,200924775001193,200924910069616,200924668607262,200924883838844,200924982079563,20092468617150,200924140553381,200924216567182,200924757500112,200924890371292,200924949454493,200924470431982,200924940949207,20092473104362,200924134660286,200924194998776,200924247962585,200924391172248,200924456864954,200924233334643,200924287190518,200924305696689,200924309917420,200924450723613,200924483953305,200924510916328,200924532814152,200924539890944,200924589316744,200924606458210,200924612402494,200924667862135,200924676465467,200924692982623,200924736316389,200924758810705,200924771869934,200924802717756,200924840999730,200924922269396,20092439317375,200924166111823,200924222868839,200924279858533,200924349241363,200924409986661,200924714945773,200924725810864,200924766289956,200924770845389,200924856903673,200924585073789,200924665760776,200924703169552,200924730992863,200924750798907,200924810741646,200924821477780,200924848214338,200924881211176,200924892593926,200924919866128,200924924515163,200924949515176,200924961857251,200924989383117,200924998887725,20092426189876,20092434646467,20092463685900,20092478220492,200924103623630,200924112305200,200924139731102,200924161567400,200924180263451,200924193894288,200924212700535,200924234063133,200924258129626,200924271920569,200924289514743,200924313582454,200924340114356,200924355891910,200924369580996,200924389565635,200924421221321,200924437333670,200924452646435,200924463607328,200924502288446,200924527272437,200924539258587,200924550149233,200924585761412,200924615040253,200924626945299,200924642844892,200924663915257,200924707407855,200924714321836,200924739196441,200924753589939,200924814275867,200924820358232,200924846581772,200924864843648,200924938853269,200924955341738,200924969911609,20092474691508,20092491252376,200924235892758,200924495342254,200924641812447,200924659498611,200924705061119,200924767008155,200924790035544,200924833220987,200924845143345,200924896931274,200924946493685,200924963761102,2009245068497,20092427931864,20092468231334,20092496582722,200924134185418,200924171806151,200924203136579,200924245698898,200924275014500,200924320246207,200924344034606,200924391174770,200924416484646,200924467367826,200924494014469,200924553210698,200924568544678,200924634616692,200924648978519,200924731156966,200924813911196
    ];

    $i = 1;

    $trackingNo = "249267111670";

    foreach ($data as $key => $value) {
        $xml = $this->body( $value, $trackingNo );

        $trackingNo += 1;

        $result = $this->httpCurl($url, $xml, 'post');
        
        echo  "{$i}--->{$value}------>{$result}". PHP_EOL;

        $i++;
    }

    die;
    return $result;
  }

  public function body( $code, $trackingNo ) {
    $body = <<<XML
<?xml version="1.0" encoding="utf-8"?>

<request>
  <deliveryOrder>
    <deliveryOrderCode>{$code}</deliveryOrderCode>
    <deliveryOrderId>{$code}</deliveryOrderId>
    <warehouseCode>self-master</warehouseCode>
    <orderType>JYCK</orderType>
    <outBizCode>{$code}</outBizCode>
    <orderConfirmTime>2019-12-09 14:50:00</orderConfirmTime>
  </deliveryOrder>
  <packages>
    <package>
      <logisticsCode>SF</logisticsCode>
      <expressCode>{$trackingNo}</expressCode>
      <weight>315.0000</weight>
      <extendProps>
        <postage>0.0000</postage>
      </extendProps>
      <items>
        <item>
          <itemCode>SAJH047</itemCode>
          <quantity>2</quantity>
        </item>
      </items>
    </package>
  </packages>
  <orderLines>

    <orderLine>
      <itemCode>SAJH047</itemCode>
      <inventoryType>ZP</inventoryType>
      <actualQty>1</actualQty>
      <batchs>
        <batch>
          <batchCode>SAJH013-001</batchCode>
          <expireDate>2021-08-07 00:00:00</expireDate>
          <actualQty>2</actualQty>
          <inventoryType>ZP</inventoryType>
        </batch>
      </batchs>
    </orderLine>

  </orderLines>
</request>

XML;
    return $body;
  }

  /**
   * @param $url
   * @param $data
   * @param string $request
   * @return return
   */
  public function httpCurl($url, $data, $requestType = 'get') {
        //初始化curl
        $ch = curl_init();
        //设置超时
        $header[] = "Content-type: text/xml";//定义content-type为xml  
        curl_setopt($ch, CURLOPT_TIMEOUT, 30);
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_SSLVERSION, CURL_SSLVERSION_TLSv1);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE);
        curl_setopt($ch, CURLOPT_HEADER, FALSE);
        curl_setopt($ch, CURLOPT_HTTPHEADER, $header);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
        if (strtolower($requestType) == 'post') {
            curl_setopt ( $ch, CURLOPT_POST, 1 );
            curl_setopt ( $ch, CURLOPT_POSTFIELDS, $data );
        }
        $return = curl_exec($ch);
        curl_close($ch);
        return $return;
    }
}

$confirm = new DeliveryConfirm();
$result = $confirm->delivery_confirm();
